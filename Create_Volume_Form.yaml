  - name: Create a Flexible volume
    showHelp: true
    help: |
    roles:
      - admin
    description: Creating Flexvol Netapp Volume
    icon: save
    categories:
      - Demo
      - Ansible
      - Maintenance
    tileClass: has-background-info-light
    playbook: Create_Volume.yaml
    type: ansible
    fields:
      - type: query
        name: Cluster
        outputObject: true
        label: Select a Cluster
        expression: fn.fnRestBasic('get','https://aiqum.demo.netapp.com/api/datacenter/cluster/clusters','','AIQUM_REST','[.records[]]')
        columns:
        - name
      - type: expression
        name: ClusterVersion
        label: "Cluster Version:"
        expression: "fn.fnRestBasic('get','https://aiqum.demo.netapp.com/api/datacenter/cluster/clusters?name=$(Cluster.name)','','AIQUM_REST','.records[].version.full')"
      - type: expression
        hide: true
        name: ClusterUUID
        default: ""
        label: "Cluster UUID:"
        expression: fn.fnRestBasic('get','https://aiqum.demo.netapp.com/api/datacenter/cluster/clusters?name=$(Cluster.name)','','AIQUM_REST','.records[].uuid')
      - type: query
        name: Vserver
        default: ""
        label: Vserver
        expression: fn.fnRestBasic('get','https://aiqum.demo.netapp.com/api/datacenter/svm/svms?cluster.name=$(Cluster.name)','','AIQUM_REST','[.records[].name]')
        columns:
        - name
      - type: text
        name: VolumeName
        label: Volume Name
        default: ""
        placeholder: "Volume Name"
        required: true
        minLength: 4
        maxLength: 10 
        regex:
          expression: "^[a-zA-Z][a-zA-z0-9]*$"
          description: Must be alpha numeric
        icon: user
      - type: expression
        name: JunctionPath
        hide: false
        default: ""
        label: Junction Path
        expression: "'/$(VolumeName)'"
      - type: expression
        name: AvailableAggregate
        hide: true
        default: __auto__
        label: Selected Most Available Aggregate
        expression: fn.fnRestBasic('get','https://aiqum.demo.netapp.com/api/datacenter/storage/aggregates?cluster.name=$(Cluster.name)&order_by=space.block_storage.available%20desc','','AIQUM_REST','[.records[].name]')
        columns:
        - name
      - type: expression
        name: aggr
        expression: "$(AvailableAggregate)[0]"
        label: "Most Available Aggregate Selected:"
      - type: enum
        name: SecurityStyle
        label: Security Style
        default: unix
        required: true
        values:
        - unix
        - ntfs
      - type: number
        name: Size
        label: Size
        default: '1'
        required: true
        minValue: 1
        maxValue: 1000000
        help: Select the size of the Volume
      - type: enum
        name: SizeUnit
        label: "Size in units:"
        default: "gb"
        required: true
        values:
        - mb
        - gb
        - tb
      - type: query
        name: SnapshotPolicy
        default: "none"
        label: Select Snapshot Policy
        expression: fn.fnRestBasic('get','https://aiqum.demo.netapp.com/api/v2/gateways/$(ClusterUUID)/storage/snapshot-policies','','AIQUM_REST','[.records[].name]')
        columns:
        - name 
      - type: expression
        name: cluster1_cred
        asCredential: true
        expression: "'cluster1_cred'"

