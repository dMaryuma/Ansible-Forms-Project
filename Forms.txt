  - name: Create a Flexible volume
    roles:                                         
    - admin
    description: This will create a flexible volume using most available aggregate
    help: This will create a flexible volume using most available aggregate
    image: data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNi4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB3aWR0aD0iNDY0cHgiIGhlaWdodD0iNDU3Ljg1MnB4IiB2aWV3Qm94PSIyNCAyNy4wNzEgNDY0IDQ1Ny44NTIiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMjQgMjcuMDcxIDQ2NCA0NTcuODUyIg0KCSB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnPg0KCTxwYXRoIGZpbGw9IiNFRDFDMjQiIGQ9Ik00NjQsODhIMzEyVjUxLjA3OGMwLTcuMTEyLTMuMTMtMTMuODIzLTguNTc4LTE4LjM5MWMtNC4wODYtMy40MzMtOS4xMjEtNS4zNjctMTQuMzQ0LTUuNTk0DQoJCWMtMS43NC0wLjA3Ni0zLjQ5NiwwLjAyOS01LjI1LDAuMzQ0TDUwLjQzNyw2OC42MjVDMzUuMTE4LDcxLjMyOSwyNCw4NC41OCwyNCwxMDAuMTQxdjMxMS43MzRjMCwxNS41NTIsMTEuMTE4LDI4LjgwNCwyNi40MzgsMzEuNQ0KCQlsMjMzLjM5MSw0MS4xODhjMS4zOTMsMC4yNDcsMi43OTYsMC4zNTksNC4xODgsMC4zNTljNS42MDEsMCwxMS4wNDctMS45NDYsMTUuNDA2LTUuNjA5YzUuNDQ4LTQuNTY4LDguNTc4LTExLjI3OSw4LjU3OC0xOC4zOTENCgkJVjQyNGgxNTJjMTMuMjMyLDAsMjQtMTAuNzY5LDI0LTI0VjExMkM0ODgsOTguNzY4LDQ3Ny4yMzIsODgsNDY0LDg4eiBNMjk2LDQ2MC45MjJjMCwzLjIzOS0xLjc5NSw1LjI0NC0yLjg1OSw2LjE0MQ0KCQljLTEuMDYzLDAuODk2LTMuMzIzLDIuMzAyLTYuNTMxLDEuNzVMNTMuMjE5LDQyNy42MjVDNDUuNTYzLDQyNi4yNzMsNDAsNDE5LjY0NCw0MCw0MTEuODZWMTAwLjE0MQ0KCQljMC03Ljc4NCw1LjU2My0xNC40MTQsMTMuMjE5LTE1Ljc2NmwyMzMuMzc1LTQxLjE4OGMwLjgwMy0wLjEzNCwxLjU1NS0wLjE0NywyLjIzNC0wLjA3OGMyLjA0LDAuMjA3LDMuNTE1LDEuMTY1LDQuMzEzLDEuODQ0DQoJCWMxLjA3MiwwLjg4LDIuODU5LDIuODg1LDIuODU5LDYuMTI1VjQ2MC45MjJ6IE00NzIsNDAwYzAsNC40MTYtMy41OTIsOC04LDhoLTg4aC02NFYxMDRoNjRoODhjNC40MDgsMCw4LDMuNTg0LDgsOFY0MDB6Ii8+DQoJPHBhdGggZmlsbD0iI0VEMUMyNCIgZD0iTTM0NCwxNDRjLTQuNDE1LDAtOCwzLjU3Ni04LDh2ODhjMCw0LjQyNCwzLjU4NSw4LDgsOGg4OGM0LjQxNiwwLDgtMy41NzYsOC04di0zMmMwLTQuNDI0LTMuNTg0LTgtOC04DQoJCWMtNC40MTUsMC04LDMuNTc2LTgsOHYyNGgtNzJ2LTcyaDQwYzQuNDE2LDAsOC0zLjU3Niw4LThzLTMuNTg0LTgtOC04SDM0NHoiLz4NCgk8cGF0aCBmaWxsPSIjRUQxQzI0IiBkPSJNNDQwLDE0NGMtMi4wNDYsMC00LjA5MiwwLjc3OS01LjY1NiwyLjM0NEwzOTIsMTg4LjY4OGwtMTAuMzQ0LTEwLjM0NGMtMy4xMjgtMy4xMjgtOC4xODQtMy4xMjgtMTEuMzEzLDANCgkJYy0zLjEyOCwzLjEyOC0zLjEyOCw4LjE4NSwwLDExLjMxM2wxNiwxNmMxLjU2MSwxLjU2LDMuNjA4LDIuMzQ0LDUuNjU2LDIuMzQ0YzIuMDQ5LDAsNC4wOTctMC43ODQsNS42NTYtMi4zNDRsNDgtNDgNCgkJYzMuMTI5LTMuMTI4LDMuMTI5LTguMTg1LDAtMTEuMzEzQzQ0NC4wOTMsMTQ0Ljc4LDQ0Mi4wNDcsMTQ0LDQ0MCwxNDR6Ii8+DQoJPHBhdGggZmlsbD0iI0VEMUMyNCIgZD0iTTQzMiwyNjRoLTg4Yy00LjQxNSwwLTgsMy41NzYtOCw4djMyYzAsNC40MjQsMy41ODUsOCw4LDhoODhjNC40MTYsMCw4LTMuNTc2LDgtOHYtMzINCgkJQzQ0MCwyNjcuNTc2LDQzNi40MTYsMjY0LDQzMiwyNjR6IE00MjQsMjk2aC03MnYtMTZoNzJWMjk2eiIvPg0KCTxwYXRoIGZpbGw9IiNFRDFDMjQiIGQ9Ik00MzIsMzI4aC04OGMtNC40MTUsMC04LDMuNTc2LTgsOHYzMmMwLDQuNDI0LDMuNTg1LDgsOCw4aDg4YzQuNDE2LDAsOC0zLjU3Niw4LTh2LTMyDQoJCUM0NDAsMzMxLjU3Niw0MzYuNDE2LDMyOCw0MzIsMzI4eiBNNDI0LDM2MGgtNzJ2LTE2aDcyVjM2MHoiLz4NCgk8cGF0aCBmaWxsPSIjRUQxQzI0IiBkPSJNMTcxLjU2NywxNzYuODk5bDU0LjczMSwxMzUuMDgybC04Mi42NzEtNjUuMTE5TDE3MS41NjcsMTc2Ljg5OXogTTI2OC43OTUsMzQzLjA5OWwtODQuMTg3LTIwMi42MDMNCgkJYy0yLjQwMi01Ljg0My03LjIxLTguOTM1LTEzLjA0Mi04LjkzNWMtNS44NDMsMC0xMC45OTgsMy4wOTEtMTMuNDAyLDguOTM1TDY1Ljc2MywzNjIuNzI3aDMxLjYwOUwxMzMuOTUsMjcxLjFsMTA5LjE1NSw4OC4xODQNCgkJYzQuMzkxLDMuNTUyLDcuNTU4LDUuMTU2LDExLjY3Nyw1LjE1NmM4LjI0NywwLDE1LjQ1NC02LjE4MSwxNS40NTQtMTUuMTA0QzI3MC4yMzYsMzQ3Ljg4MSwyNjkuNzIyLDM0NS41NzUsMjY4Ljc5NSwzNDMuMDk5DQoJCUwyNjguNzk1LDM0My4wOTl6Ii8+DQo8L2c+DQo8L3N2Zz4NCg==
    categories:                                    
    - ONTAP
    tileClass: has-background-success-light        # a bulma background color style (https://bulma.io)
    playbook: Create_Volume.yaml                      # playbook to launch (only if type = ansible)
    inventory: ""                       # optional ansible inventory file
    check: false                                   # run in checkmode or not
    diff: false                                    # show differences
    tags: vm,create                                # optional ansible tags (comma separated)
    type: ansible                                 
    fields:
      - type: query
        name: Cluster
        outputObject: true
        label: Select a Cluster
        expression: fn.fnRestBasic('get','https://aiqum.demo.netapp.com/api/datacenter/cluster/clusters','','AIQUM_REST','[.records[]]')
        columns:
        - name
      - type: expression
        name: ClusterVersion
        label: "Cluster Version:"
        expression: "fn.fnRestBasic('get','https://aiqum.demo.netapp.com/api/datacenter/cluster/clusters?name=$(Cluster.name)','','AIQUM_REST','.records[].version.full')"
      - type: expression
        hide: true
        name: ClusterUUID
        default: ""
        label: "Cluster UUID:"
        expression: fn.fnRestBasic('get','https://aiqum.demo.netapp.com/api/datacenter/cluster/clusters?name=$(Cluster.name)','','AIQUM_REST','.records[].uuid')
      - type: query
        name: Vserver
        default: ""
        label: Vserver
        expression: fn.fnRestBasic('get','https://aiqum.demo.netapp.com/api/datacenter/svm/svms?cluster.name=$(Cluster.name)','','AIQUM_REST','[.records[].name]')
        columns:
        - name
      - type: text
        name: VolumeName
        label: Volume Name
        default: ""
        placeholder: "Volume Name"
        required: true
        minLength: 4
        maxLength: 10
        regex: "^[a-zA-Z][a-zA-z0-9]*$"
        regexDescription: Must be alpha numeric, cannot start with number
        icon: user
      - type: expression
        name: JunctionPath
        hide: false
        default: ""
        label: Junction Path
        expression: "'/$(VolumeName)'"
      - type: expression
        name: AvailableAggregate
        hide: true
        default: __auto__
        label: Selected Most Available Aggregate
        expression: fn.fnRestBasic('get','https://aiqum.demo.netapp.com/api/datacenter/storage/aggregates?cluster.name=$(Cluster.name)&order_by=space.block_storage.available%20desc','','AIQUM_REST','[.records[].name]')
        columns:
        - name
      - type: expression
        name: aggr
        expression: "$(AvailableAggregate)[0]"
        label: "Most Available Aggregate Selected:"
      - type: enum
        name: SecurityStyle
        label: Security Style
        default: unix
        required: true
        values:
        - unix
        - ntfs
      - type: number
        name: Size
        label: Size
        default: '1'
        required: true
        minValue: 1
        maxValue: 1000000
        help: Select the size of the Volume
      - type: enum
        name: SizeUnit
        label: "Size in units:"
        default: "gb"
        required: true
        values:
        - mb
        - gb
        - tb
      - type: query
        name: SnapshotPolicy
        default: "none"
        label: Select Snapshot Policy
        expression: fn.fnRestBasic('get','https://aiqum.demo.netapp.com/api/v2/gateways/$(ClusterUUID)/storage/snapshot-policies','','AIQUM_REST','[.records[].name]')
        columns:
        - name 
      - type: checkbox
        name: CreateCifsShare
        label: "Create Cifs Share?"
        default: true
      - type: text
        name: CifsShareName
        label: Cifs Share Name
        default: "none"
        placeholder: "Cifs Share Name"
        required: true
        minLength: 4
        maxLength: 10
        regex: "^[a-zA-Z][a-zA-z0-9]*$"
        regexDescription: Must be alpha numeric, cannot start with number
        icon: user
        dependencies:
          - name: CreateCifsShare
            values:
              - true
      
      
